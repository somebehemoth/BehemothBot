const Discord = require('discord.js');
const { prefix, token } = require('./config.json');
const axios = require('axios');
const cheerio = require('cheerio');
const request = require('request');

const client = new Discord.Client();

client.once('ready', () => {
	console.log('Ready! BehemothBot is online.');
});

client.on('message', message => {
	console.log(message.content);
	if (!message.content.startsWith(prefix) || message.author.bot) return;

	const args = message.content.slice(prefix.length).trim().split(/ +/);
	const command = args.shift().toLowerCase();

	if (command === 'ping') {
		message.channel.send('pong')
	}
	else if (command === 'calljs') {
		message.channel.send('Discord.js and BehemothBot.js and config.json are all up and working')
	}
	else if (command === 'meme') {
		const getPostTitles = async () => {
			try {
				const { data } = await axios.get(
					'https://old.reddit.com/r/dankmemes/new/'
				);
				const $ = cheerio.load(data);
				const postTitles = [];

				$('div > p.title > a').each((_idx, el) => {
					const postTitle = $(el).text()
					postTitles.push(postTitle)
				});

				const a = $("img").attr("href")
				const img = $('img').attr("src")
				const href = $('div > p.title > a').attr("href")
				const imglink = 'https://www.reddit.com' + href

				const Embed = new Discord.MessageEmbed()
					.setColor('#0099ff')
					.setTitle('Meme')
					.setDescription(imglink)
					.setImage('http:' + img)
					.setTimestamp()
					.setFooter('BehemothBot');
				message.channel.send(Embed);
				return postTitles;
			} catch (error) {
				throw error;
			}
		};
		getPostTitles()
			.then((postTitles) => console.log(postTitles));
		// other commands...
	};
})
client.login(token)
